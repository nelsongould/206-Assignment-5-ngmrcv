---
title: "Assignment 4 Rmarkdown"
author: "Nelson Gould"
date: "11/26/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Install packages and read in csv files

library(tidyverse)
library(knitr)
library(kableExtra)
library(plotly)
library(extrafont)
library(effsize)
library(vcdExtra)
library(car)
library(ggsignif)
library(stargazer)

grad_enroll <- read_csv("grad_enroll_simplified.csv")
doc_salary <- read_csv("median_doctoral_salary.csv")
faculty_salary <- read_csv("faculty_salary_data.csv")
phd_field <- read_csv("phd_by_field_simplified.csv")

```


```{r}

# 1. Male and female graduate enrollment (1967 - 2015).

male_female_grad_graph <- ggplot(grad_enroll, aes(x = Year)) +
  geom_point(aes(y = total_males/1000), color = "skyblue", alpha = 0.75) +
  geom_point(aes(y = total_females/1000), color = "tomato", alpha = 0.75) +
  theme_classic() +
  labs(y = "Graduate Enrollment Count (1000 students)") +
  geom_smooth(aes(y = total_males/1000), method = lm, se = TRUE, size = 0.5, color = "skyblue", fill = "skyblue",alpha = 0.25) +
  geom_smooth(aes(y = total_females/1000), method = lm, se = TRUE, size = 0.5, color = "tomato", fill = "tomato",alpha = 0.25) +
  scale_x_continuous(expand = c(0,0),limits = c(1966,2016)) +
  scale_y_continuous(expand = c(0,0),limits = c(250,1800))
  
male_female_grad_graph

# Trend analysis
# Male

male_grad_enroll_model <- lm(total_males/1000 ~ Year, data = grad_enroll)
summary(male_grad_enroll_model)

cor.test(grad_enroll$Year, grad_enroll$total_males/1000)

# Female
female_grad_enroll_model <- lm(total_females/1000 ~ Year, data = grad_enroll)
summary(female_grad_enroll_model)

cor.test(grad_enroll$Year, grad_enroll$total_females/1000)

# total_males = 9.069(Year) - 17112.153 -- R^2 = 0.8545 -- F(1,47) = 276, p < 2.2x10^-16 -- R = 0.9243

# total_females = 30.13(Year) - 58955.50 -- R^2 = 0.9827 -- F(1,47) = 2669, p < 2.2x10^-16 -- R = 0.9913

plot(male_grad_enroll_model)
plot(female_grad_enroll_model)

```


```{r}

# 2. Shifts in female PhD recipients by field (1985, 2000, and 2015).

phd_field %>%
  filter(field_of_study != "NA" | field_of_study != "Female") %>%
  select(field_of_study, number_1985, number_2000, number_2015)




```



```{r}

# 3. Male and female salaries for starting postdoctoral and other employment positions (2015).

mf_sal_postdoc_sum <- doc_salary %>% 
  group_by(sex) %>% 
  filter(postgrad_plan == "Postdoctoral study") %>% 
  summarize(
    mean_salary = mean(salary),
    sd_salary = sd(salary),
    sample_size = length(salary)
  )
mf_sal_postdoc_sum

mf_sal_empl_sum <- doc_salary %>% 
  group_by(sex) %>% 
  filter(postgrad_plan == "Employment") %>% 
  summarize(
    mean_salary = mean(salary),
    sd_salary = sd(salary),
    sample_size = length(salary)
  )
mf_sal_empl_sum

# Exploratory Histogram and QQ-plot

mf_sal_hist <-  ggplot(doc_salary, aes(doc_salary$salary)) +
  geom_histogram(aes(fill = sex, bins = 10), position = "dodge")
mf_sal_hist

# Summary Graph

male_female_sal_graph <- ggplot(mf_sal_sum, aes(x=sex, y = mean_salary)) +
  geom_col()

male_female_sal_graph
```

```{r}

# 4. Multiple linear regression

# Visualize salary by sex

by_sex <- ggplot(faculty_salary, aes(x = Salary)) +
  geom_density(aes(color = Sex, fill = Sex), alpha = 0.3) +
  theme_classic() +
  scale_x_continuous(expand = c(0,0), limits = c(0,250000)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Salary", y = "Density")

by_sex

```

```{r}
# 4 (cont.)

# Relationship b/w rank and salary

by_rank <- ggplot(faculty_salary, aes(x = faculty_rank, y = Salary)) +
  geom_point(aes(color = Sex, pch = Sex), alpha = 0.5) +
  facet_wrap(~Sex)

by_rank

```

```{r}
# 4 (cont.)

# saturated model

salary_lm1 <- lm(Salary ~ faculty_rank + Years_Since_PhD + Years_Faculty_Service + Sex + discipline, data = faculty_salary)

salary_lm1

```

```{r}
# 4 (cont.)

# updated model

salary_lm2 <- lm(Salary ~ faculty_rank + Sex + discipline, data = faculty_salary)

salary_lm2

summary(salary_lm2)

```

